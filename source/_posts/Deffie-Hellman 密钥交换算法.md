---
abbrlink: dcb67373
date: 2021-07-02
description: DH 密钥交换算法
---
Deffie-Hellman 简称 DH 算法。

### 背景

对称加密算法，解决了数据加密的问题。加密后的密文，即使被中间人截获，没有密钥也无法破解。

但是问题来了，对称加密需要双方提前协商好密钥。

在不安全的信道上传输信息是可以的，因为只要密钥不泄漏，黑客也无法破解信息。

但是密钥在不安全的信道是无法保证安全的。

所以 DH 算法解决的问题就是，如何保证密钥在不安全的信道下的安全。

### 原理

DH 算法本质上是使用非对称加密。

我们来看 DH 算法交换密钥的步骤。假设甲乙双方需要传递密钥，他们之间可以这么做：

1. 甲首选选择一个素数`p`，例如 509，底数`g`，任选，例如 5，随机数`a`，例如 123，然后计算`A=g^a mod p`，结果是 215，然后，甲发送`p＝509`，`g=5`，`A=215`给乙；

2. 乙方收到后，也选择一个随机数`b`，例如，456，然后计算`B=g^b mod p`，结果是 181，乙再同时计算`s=A^b mod p`，结果是 121；

3. 乙把计算的`B=181`发给甲，甲计算`s＝B^a mod p`的余数，计算结果与乙算出的结果一样，都是 121。

所以最终双方协商出的密钥`s`是 121。

注意到这个密钥`s`并没有在网络上传输。而通过网络传输的`p`，`g`，`A`和`B`是无法推算出`s`的，因为实际算法选择的素数是非常大的。

所以，更确切地说，DH 算法是一个密钥协商算法，双方最终协商出一个共同的密钥，而这个密钥不会通过网络传输。

如果我们把`a`看成甲的私钥，`A`看成甲的公钥，`b`看成乙的私钥，`B`看成乙的公钥，DH 算法的本质就是双方各自生成自己的私钥和公钥，私钥仅对自己可见，然后交换公钥，并根据自己的私钥和对方的公钥，生成最终的密钥`secretKey`，DH 算法通过数学定律保证了双方各自计算出的`secretKey`是相同的。

### 缺点

DH 算法解决了密钥交换的安全性问题，但是没有解决中间人攻击。

当中间人构造属于自己的公钥，并与甲乙双方通信，即可造成中间人攻击。

至于怎么解决中间人攻击，可以参考 HTTPS，即公钥需要经过验证，需要有 CA 颁发的证书，这样就能确认对方的身份。
